<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style>
	body{
		margin: 0;
	}
		canvas{
			box-shadow: 0 0 4px;		
		}
	</style>
</head>
<body>
	<canvas id="c" width="600" height="600"></canvas>
	<button onclick="r(1)">l</button><button onclick="r()">r</button>
	<button onclick="z(1)">z in</button><button onclick="z()">z out</button>
	<script>
		var ctx = c.getContext('2d'), width = 600, height = 600;
		var img = new Image(), imgWidth, imgHeight;
		var scale = 1;
		var rotationImages = [];

		var rotateCanvas = document.createElement('canvas');
		var rctx = rotateCanvas.getContext('2d');

		var mousedownPos = {x: 0, y: 0}, moving = false, originPos = {x: 0, y: 0};
		var deltaPos = {x: 0, y: 0};
		img.src = 'small.png';
		img.onload = function(){
			imgWidth = rotateCanvas.width = img.width;
			imgHeight = rotateCanvas.height = img.height;
			originPos = {x: (width-imgWidth)/2, y: (height-imgHeight)/2};
			ctx.drawImage(img, 0, 0, imgWidth, imgHeight, originPos.x-imgWidth*(scale-1)/2, originPos.y-imgHeight* (scale-1)/2, imgWidth * scale, imgHeight * scale);
		};
		window.addEventListener('mousedown', function(e){
			mousedownPos.x = e.pageX;
			mousedownPos.y = e.pageY;
			moving = true;
		});
		window.addEventListener('mousemove', function(e){
			if(moving){
				deltaPos.x = e.pageX - mousedownPos.x;
				deltaPos.y = e.pageY - mousedownPos.y;
				console.log(deltaPos);
				ctx.clearRect(0,0,width,height);

				ctx.drawImage(img, 0, 0, img.width, img.height, originPos.x + deltaPos.x * scale, originPos.y + deltaPos.y * scale, img.width * scale, img.height * scale);
			}
		});
		window.addEventListener('mouseup', function(){
			moving = false;
			originPos.x += deltaPos.x * scale;
			originPos.y += deltaPos.y * scale;
		});

		function r(isLeft){
			return ;
			ctx.clearRect(0,0,width,height);
			if(isLeft){
				rctx.translate(width, 0);
				rctx.rotate(Math.PI / 2);
			}else{
				rctx.translate(width, 0);
				rctx.rotate(Math.PI / -2);
			}
			rctx.drawImage(img, 0, 0);
			var imgData = rctx.getImageData(0, 0, width, height);
			ctx.putImageData(imgData, 0, 0);
		}

		function z(isIn){
			ctx.clearRect(0,0,width,height);
			var tmpScale;
			if(isIn){
				tmpScale = 1.1;
			}else{
				tmpScale = 1/1.1;
			}
			scale *= tmpScale;
			ctx.clearRect(0,0,width,height);
			ctx.drawImage(img, 0, 0, imgWidth, imgHeight, originPos.x-imgWidth*(tmpScale-1)/2, originPos.y-imgHeight* (tmpScale-1)/2, imgWidth * scale, imgHeight * scale);
			originPos.x = originPos.x-imgWidth*(tmpScale-1)/2;
			originPos.y = originPos.y-imgHeight* (tmpScale-1)/2;
		}
	</script>
</body>
</html>